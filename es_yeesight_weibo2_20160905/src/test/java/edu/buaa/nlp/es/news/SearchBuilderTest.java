package edu.buaa.nlp.es.news;

import edu.buaa.nlp.es.client.ESClient;
import junit.framework.TestCase;
import org.elasticsearch.action.delete.DeleteResponse;
import org.elasticsearch.action.search.SearchResponse;
import org.elasticsearch.client.Client;
import org.elasticsearch.search.SearchHit;
import org.elasticsearch.search.SearchHits;

import java.util.LinkedList;
import java.util.List;

/**
 * @author TW
 * @date TW on 2016/9/19.
 */
public class SearchBuilderTest
        extends TestCase {

    public void testBuildQuery()
            throws Exception {
        //String json = "{\"keyword\":\"(\\\"US navy\\\" and  and (\\\"technology\\\" or \\\"new\\\" or \\\"launch\\\" or \\\"order\\\" or \\\"finance\\\" or \\\"equipment\\\" or \\\"carrier\\\" or \\\"win\\\" or \\\"contract\\\" or \\\"invest\\\" or \\\"adopt\\\" or \\\"design\\\")) or \\\"littoral combatship\\\"\",\"order\":\"desc\",\"fieldName\":\"_score\",\"highlight\":false,\"resultType\":\"front\",\"pageNo\":\"1\",\"pageSize\":\"10\",\"similarityId\":\"\",\"isSensitive\":[0]}";
        String json = "{\"keyword\":\"房产\",\"beginDate\":\"2016-01-01 00:00:00\",\"endDate\":\"2016-12-31 00:00:00\",\"order\":\"asc\",\"fieldName\":\"_score\",\"highlight\":true,\"resultType\":\"front\",\"pageNo\":\"1\",\"pageSize\":\"100\",\"similarityId\":\"\",\"isSensitive\":[0]}";
        System.out.println(json);
        //String json = "(抗生素) and  (()or () and ())";
      SearchBuilder searchBuilder = new  SearchBuilder();
        //System.out.println(searchBuilder.initKeyword(json));
        System.out.println( searchBuilder.crossSearch(json));
    }

    public void testDelete()
            throws Exception {
        //edu.buaa.nlp.es.client.SearchBuilder searchBuilder = new edu.buaa.nlp.es.client.SearchBuilder();
        Client client= ESClient.getClient();
        String queryJson = "{}";
        //String queryJson = "{\"query\":{\"filtered\":{\"query\":{\"match_all\":{}},\"filter\":{\"bool\":{\"should\":{\"terms\":{\"websiteId\":[347139,341728,323032,392737,425055,348274,341397,341480,347084,453016,347403,347402,347401,347400,347399,347398,347397,347396,347395,347394,347393,347392,347391,347390,347362,341803,341802,341801,341800,341799,341797,341796,341795,341794,341793,341792,341791,341790,341789,382191,449195,393276,458613,448203,347843,347841,347840,347839,347838,347837,347836,347835,347834,347833,347832,347831,347830,347829,347800,349448,349447,349446,349445,349444,349443,349442,349441,349440,349439,349438,349437,349436,349435,349422,341527,341526,341525,341524,341523,341522,341521,341520,341519,341518,341517,341516,341515,341514,341513,344834,344833,344832,344831,344830,344829,344828,344827,344826,344825,344824,344823,344822,344821,344797,344145,344144,344143,344142,344141,344140,344139,344138,344137,344136,344135,344134,344133,344132,344131,450718,373935,418963,374869,368898,373154,369796,373093,372740,372035,372034,321903,323802,369267,369069,368241,367686,367662,366547,365432,365021,364448,364427,363624,363623,363622,363174,360293,364799,364792,369056,372029,369926,369925,369923,369922,369921,369920,369919,369918,369917,369916,369915,369914,369913,369911,369910,369544,369543,369542,369541,369540,369539,369538,369537,369536,369535,369534,369533,369532,369531,369530,369448,369447,369446,369445,369444,369443,369442,369441,369440,369439,369438,369437,369436,369435,369434,369290,369289,369288,369287,369286,369285,369284,369283,369282,369281,369280,369279,369278,369277,369276,362317,362316,362315,362314,362313,362312,362311,362310,362309,362308,362307,362306,362305,362304,362303,361478,361477,361476,361475,361474,361473,361472,361471,361470,361469,361468,361467,361466,361465,361464,360669,360668,360667,360666,360665,360664,360663,360662,360661,360660,360659,360658,360657,360656,360655,360614,360613,360612,360611,360610,360609,360608,360607,360606,360605,360604,360603,360602,360601,360600,360232,360231,360230,360229,360228,360227,360226,360225,360224,360223,360222,360221,360220,360219,360218,359568,359567,359566,359565,359564,359563,359562,359561,359560,359559,359558,359557,359556,359555,359554,358408,358407,358406,358405,358404,358403,358402,358401,358400,358399,358398,358397,358396,358395,358394,358253,358252,358251,358250,358249,358248,358247,358246,358245,358244,358243,358242,358241,358240,358239,358149,358148,358147,358146,358145,358144,358142,358141,358140,358139,358138,358137,358136,358135,358104,358103,358102,358101,358100,358099,358097,358096,358095,358094,358093,358092,358091,358090,356602,356601,356600,356599,356598,356597,356595,356594,356593,356592,356591,356590,356589,356588,356518,356517,356516,356514,356513,356512,356510,356509,356508,356507,356506,356505,356504,356503,356148,356147,356146,356145,356144,356143,356142,356141,356140,356139,356138,356137,356136,356134,356133,355335,355334,355333,355332,355331,355330,355328,355327,355326,355325,355324,355323,355322,355321,355232,355231,355230,355229,355228,355227,355225,355224,355223,355222,355221,355220,355219,355218,354957,354956,354955,354952,354951,354950,354949,354948,354947,354946,354945,354960,354959,354958,354398,354397,354396,354395,354394,354393,354391,354390,354389,354388,354387,354386,354385,354384,353546,353545,353544,353543,353542,353541,353539,353538,353537,353536,353535,353534,353533,353532,353005,353003,353001,352999,352997,352995,352991,352990,352989,352988,352987,352986,352985,352984,352819,352817,352816,352815,352786,352785,352784,352783,352782,352781,352780,352779,352778,352777,352164,352162,352160,352158,352156,352154,352149,352146,352143,352140,352137,352135,352133,352131,351346,351344,351342,351340,351338,351336,351334,351333,351332,351331,351330,351329,351328,351327,351310,351309,351308,351307,351306,351305,351303,351302,351301,351300,351299,351298,351296,351295,350105,350104,350103,350102,350101,350100,350098,350097,350096,350095,350094,350093,350092,350091,349492,349491,349490,349489,349488,349487,349485,349484,349483,349482,349480,349479,349478,331585,331569,331534,331532,331527,331524,331521,331520,331513,331489,331486,331301,331290,331239,331235,331223,398070,398068,398064,398061,398015,398010,397993,397991,397986,397957,401068,401045,401029,400960,324086,324085,324060,398266,398247,398246,398228,398221,398220,398206,400814,400770,400769,400765,400761,400750,400749,400738,400717,347919,396148,342210,341788,409417,458396,345988,345987,345985,345984,345983,345982,345981,345980,345979,345978,345977,345975,345974,345973,364385,364384,364383,364382,364381,364380,364379,364378,364377,364376,364375,364374,364373,364372,364341,363510,363509,363508,363507,363506,363505,363504,363503,363502,363501,363500,363499,363498,363497,363471,364737,364736,364735,364734,364733,364732,364731,364730,364729,364728,364727,364726,364724,364723,364722,364101,364100,364099,364098,364097,364096,364095,364094,364093,364092,364091,364090,364088,364087,364050,366913,366912,366910,366909,366908,366907,366906,366905,366904,366903,366902,366901,366900,366899,366898,351972,351971,351970,351969,351968,351967,351966,351965,351964,351963,351962,351961,351960,351959,351955,358988,358987,358986,358985,358984,358983,358982,358981,358980,358978,358976,358975,358974,358973,358887,342133,342132,342131,342130,342129,342128,342127,342126,342125,342124,342123,342122,342121,342120,342119,358276,358275,358274,358273,358272,358271,358270,358269,358268,358267,358266,358265,358264,358263,358235,341896,341895,341894,341893,341892,341890,341889,341888,341887,341886,341885,341884,341883,341882,341877,371213,371212,371211,371210,371209,371208,371207,371206,371205,371204,371203,371202,371201,371200,371171,369907,369906,369905,369904,369903,369902,369901,369900,369899,369898,369897,369896,369895,369894,369893,369505,369504,369503,369502,369501,369500,369499,369498,369497,369496,369495,369494,369493,369492,369469,368497,368496,368495,368494,368493,368492,368491,368490,368489,368488,368487,368486,368485,368484,368478,367834,367832,367831,367830,367829,367828,367827,367826,367825,367824,367823,367822,367821,367820,367814,367792,367791,367790,367789,367788,367787,367786,367785,367784,367783,367782,367781,367780,367779,367765,367403,367402,367401,367400,367399,367398,367397,367396,367395,367394,367393,367392,367391,367390,367370,366235,366234,366233,366232,366231,366230,366229,366228,366227,366226,366225,366224,366223,366222,366221,365229,365228,365227,365226,365225,365224,365223,365222,365221,365220,365219,365218,365217,365216,365215,365180,365179,365178,365177,365176,365175,365174,365173,365172,365171,365170,365169,365168,365167,365166,365045,365044,365043,365042,365041,365040,365039,365037,365036,365035,365034,365033,365032,365031,365030,364330,364329,364328,364327,364326,364325,364324,364323,364322,364321,364320,364319,364318,364317,364231,363689,363687,363686,363685,363684,363683,363682,363681,363680,363679,363678,363677,363676,363675,363674,363013,363012,363011,363010,363009,363008,363007,363006,363005,363004,363003,363002,363001,363000,362989,362806,362804,362803,362802,362801,362800,362799,362798,362797,362796,362795,362794,362793,362792,362760,362246,362245,362244,362243,362242,362241,362240,362239,362238,362237,362236,362235,362234,362233,362232,362075,362074,362073,362072,362071,362070,362069,362068,362067,362066,362065,362064,362063,362062,362047,361967,361965,361964,361963,361962,361961,361960,361959,361958,361957,361956,361955,361954,361953,361945,361625,361624,361623,361622,361621,361620,361619,361618,361617,361616,361615,361614,361613,361612,361604,361420,361419,361418,361417,361416,361414,361413,361412,361411,361410,361409,361408,361407,361406,361385,361250,361249,361248,361247,361246,361245,361244,361243,361242,361241,361240,361239,361238,361237,361226,361131,361130,361129,361128,361127,361126,361125,361123,361122,361121,361120,361119,361118,361117,361074,361007,361006,361005,361004,361003,361002,361001,361000,360999,360998,360997,360996,360995,360994,360979,360551,360550,360549,360548,360547,360546,360545,360544,360542,360540,360538,360536,360534,360532,360506,360347,360346,360345,360344,360343,360342,360341,360340,360338,360337,360336,360335,360334,360333,360323,451692,359857,359835,359834,366616,357663,357662,357661,357660,357659,357658,357657,357656,357655,357654,357653,357652,357651,357650,357625,357611,357610,357609,357608,357607,357606,357605,357604,357603,357602,357601,357600,357599,357598,357597,357533,357532,357531,357530,357529,357528,357527,357526,357525,357524,357523,357522,357521,357520,357502,356641,356640,356639,356638,356637,356636,356634,356633,356632,356631,356630,356629,356628,356627,356204,356203,356202,356201,356200,356199,356198,356197,356196,356195,356194,356193,356192,356191,356156,356030,356029,356028,356027,356026,356025,356024,356023,356022,356021,356020,356019,356018,356017,355992,355936,355935,355934,355933,355932,355931,355930,355929,355928,355927,355926,355925,355924,355923,355874,353948,353947,353946,353945,353944,353943,353941,353940,353939,353938,353937,353936,353935,353934,353143,353142,353140,353139,353138,353137,353136,353135,353134,353133,353132,353131,353130,353129,353111,352946,352945,352943,352942,352941,352940,352939,352938,352937,352936,352935,352934,352931,352929,352913,352517,352516,352515,352514,352513,352512,352511,352510,352509,352508,352507,352506,352505,352503,352089,352088,352087,352086,352085,352084,352083,352082,352081,352080,352079,352078,352077,352076,352058,351860,351859,351858,351857,351856,351855,351854,351853,351852,351851,351850,351849,351848,351847,351743,351742,351741,351740,351739,351738,351737,351736,351735,351734,351733,351732,351731,351730,351688,350730,350729,350728,350727,350726,350725,350724,350723,350722,350721,350720,350719,350718,350717,350335,350334,350333,350332,350331,350330,350329,350328,350327,350326,350325,350324,350323,350322,350274,349878,349877,349876,349875,349874,349873,349872,349871,349870,349869,349868,349867,349866,349865,349827,349826,349825,349824,349822,349821,349820,349819,349818,349817,349816,349815,349814,349813,349764,349763,349762,349761,349760,349759,349758,349756,349755,349754,349753,349752,349751,349750,349723,349515,349514,349513,349512,349511,349510,349509,349508,349507,349506,349505,349504,349503,349502,349475,349180,349179,349178,349177,349176,349175,349174,349173,349172,349171,349170,349169,349168,349167,349159,348955,348954,348953,348952,348951,348950,348949,348948,348947,348946,348945,348944,348943,348942,348920,348769,348768,348767,348766,348765,348764,348762,348761,348760,348759,348758,348757,348756,348755,348725,348724,348723,348722,348721,348720,348719,348718,348717,348716,348715,348714,348713,348712,348688,348527,348526,348525,348524,348523,348522,348521,348520,348519,348518,348517,348516,348515,348514,348491,348288,348286,348284,348282,348280,348278,348276,348272,348270,348269,348268,348267,348266,348199,348198,348197,348196,348195,348194,348193,348192,348191,348190,348189,348188,348187,348186,348180,347383,347382,347381,347380,347379,347378,347376,347375,347374,347373,347372,347371,347370,347369,347368,347184,347183,347182,347181,347180,347179,347178,347177,347176,347175,347174,347173,347172,347171,347153,347152,347151,347150,347149,347148,347147,347146,347144,347143,347142,347141,347140,347120,451681,347089,347088,347086,347085,347082,347081,347080,347079,347078,347077,347076,347075,347074,347073,345883,345882,345881,345880,345879,345878,345877,345876,345875,345874,345873,345853,345792,342406,342405,342404,342403,342402,342400,342398,342396,342394,342392,342390,342387,342385,342383,342381,342224,342221,342219,342217,342215,342214,342213,342212,342211,342209,342208,342207,342206,342169,342195,342194,342193,342192,342191,342190,342189,342188,342187,342186,342185,342184,342183,342182,342181,342001,342000,341998,341997,341996,341995,341994,341993,341992,341991,341990,341988,341987,341986,341985,341955,341954,341953,341952,341951,341950,341949,341948,341947,341946,341945,341944,341943,341942,341932,341919,341875,341874,341873,341872,341871,341870,341869,341868,341867,341866,341865,341864,341863,341862,341861,341787,341786,341785,341784,341783,341782,341781,341780,341779,341778,341777,341776,341775,341774,341637,341738,341736,341734,341732,341730,341726,341724,341722,341720,341718,341716,341714,341712,341710,341652,341651,341650,341649,341648,341647,341646,341645,341644,341643,341642,341641,341640,341639,341638,341611,341610,341609,341608,341607,341606,341605,341604,341603,341601,341600,341599,341598,341597,341596,341573,341572,341571,341570,341569,341568,341567,341566,341565,341564,341563,341562,341561,341560,341529,341484,341483,341482,341481,341479,341478,341477,341476,341474,341473,341472,341471,341470,341327,341403,341402,341401,341400,341399,341398,341396,341395,341394,341393,341392,341391,341390,341360,324218,323034,323033,323031,323030,323029,323028,323027,323025,323024,323023,323022,323000,345502,391866,391312]}}}}}}}";
        SearchResponse response = client.prepareSearch("news*")
                .setTypes("article")
                .setSource(queryJson)
                .execute()
                .actionGet();
        SearchHits hits = response.getHits();
        List<String> id = new LinkedList<>();
        for(SearchHit hit : hits){
            id.add(hit.getId());
            System.out.println(hit.getId());
            DeleteResponse deleteResponse = client.prepareDelete("news*", "article", hit.getId()).get();
        }
    }

}